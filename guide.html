<!--
Guide public premium – version statique sans build
- Fichier: guide.html à placer à la racine du repo (à côté de index.html)
- URL finale: https://conciergeriezenata.com/guide/<slug>
- Nécessite un fichier _redirects (à la racine) avec:
    /guide/*   /guide.html?slug=:splat   200

- Lit le JSON public dans Supabase Storage: https://<SUPABASE_URL>/storage/v1/object/public/guides/<slug>.json
- Gestion du token: /guide/<slug>?token=XXXX pour afficher les champs sensibles
- Aucun framework, aucune clé d'API requise pour la lecture (public)

<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Guide Voyageur – Conciergerie Zenata</title>
  <meta name="theme-color" content="#0f172a"/>
  <style>
    :root{--ink:#0f172a;--muted:#475569;--line:#e2e8f0;--bg:#ffffff;--card:#f8fafc;--brand:#111827}
    *{box-sizing:border-box}html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--ink);background:var(--bg)}
    .container{max-width:1120px;margin:0 auto;padding:20px}
    .header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 0}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .brand img{height:28px}
    .badge{font-size:12px;color:var(--muted)}
    .hero{border-radius:20px;overflow:hidden;border:1px solid var(--line);background:#000}
    .hero img{width:100%;height:420px;object-fit:cover;display:block;opacity:.95}
    .grid{display:grid;gap:16px}
    .grid-3{grid-template-columns:1fr 1fr 1fr}
    .grid-2{grid-template-columns:1.15fr .85fr}
    @media(max-width:960px){.grid-2,.grid-3{grid-template-columns:1fr}}
    .tile{border:1px solid var(--line);border-radius:14px;padding:12px;background:#fff}
    .tile .k{font-size:12px;color:var(--muted)}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;overflow:hidden}
    .card h2{margin:0;padding:12px 14px;border-bottom:1px solid var(--line);font-size:16px}
    .card .content{padding:16px}
    ul{margin:8px 0;padding-left:18px}
    .pill{display:inline-flex;gap:6px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;font-size:12px;margin:4px 6px 0 0;background:#fff}
    .muted{color:var(--muted)}
    .warn{background:#fffbeb;border:1px solid #fef3c7;color:#92400e;padding:10px 12px;border-radius:12px;font-size:13px}
    .footer{padding:28px 0;text-align:center;color:var(--muted);font-size:12px}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid var(--line);background:#fff;border-radius:12px;padding:10px 14px;cursor:pointer}
    .btn.primary{background:var(--brand);color:#fff;border-color:var(--brand)}
    .sr{position:absolute;left:-9999px}
    .hidden{display:none}
  </style>
</head>
<body>
  <header class="container header">
    <div class="brand"><img src="/logo/logo_officiel_couleur_picto.png" alt="CZ"> Conciergerie Zenata</div>
    <div class="badge" id="guideSlug"></div>
  </header>

  <main class="container" id="root">
    <p class="muted">Chargement du guide…</p>
  </main>

  <footer class="container footer">© <span id="year"></span> Conciergerie Zenata</footer>

  <script>
    // === CONFIG — mets simplement ton URL Supabase ici ===
    const SUPABASE_URL = "https://ojgchrqtvkwzhjvwwftd.supabase.co"; // <- la tienne
    const GUIDES_BUCKET = "guides";

    const qs = new URL(location.href);
    const slug = (qs.searchParams.get('slug') || location.pathname.split('/').filter(Boolean).pop() || '').trim();
    const token = qs.searchParams.get('token') || '';

    document.getElementById('year').textContent = new Date().getFullYear();
    document.getElementById('guideSlug').textContent = slug ? `#${slug}` : '';

    const root = document.getElementById('root');

    function html(strings, ...vals){ return strings.map((s,i)=>s+(vals[i]??'')).join(''); }

    function section(g){
      const a = g.arrival?.fr || {};
      const allow = g.__sensitive?.token ? (token === g.__sensitive.token) : true;
      const door = allow ? (a.doorCode||'') : '•••• (masqué)';
      const rules = g.rules?.fr?.items || [];
      const dep = g.departure?.fr || {};
      const ess = g.essentials?.fr || {};
      const ams = g.amenities || [];

      return html`
        <div class="grid" style="gap:18px">
          <div class="hero"><img alt="${g.name||''}" src="${g.cover?.imageUrl||''}"></div>

          <div class="grid grid-3">
            <div class="tile"><div class="k">Adresse</div><div><strong>${g.address||''}</strong></div></div>
            <div class="tile"><div class="k">Wi‑Fi</div><div><strong>${(a.wifi?.ssid||'')}${a.wifi?.password? ' • '+a.wifi.password: ''}</strong></div></div>
            <div class="tile"><div class="k">Code porte</div><div><strong>${door}</strong></div></div>
          </div>

          <div class="grid grid-2">
            <div class="card"><h2>Arrivée & Check‑in</h2><div class="content">
              <div><span class="muted">À partir de</span> <strong>${a.checkin_from||''}</strong></div>
              ${a.parking? `<div><span class="muted">Parking</span> <strong>${a.parking}</strong></div>`:''}
              ${(a.notes||[]).length? `<ul>${(a.notes||[]).map(n=>`<li>${n}</li>`).join('')}</ul>`:''}
            </div></div>

            <div class="card"><h2>Règles</h2><div class="content"><ul>${rules.map(r=>`<li>${r}</li>`).join('')}</ul></div></div>

            <div class="card"><h2>Départ & Check‑out</h2><div class="content">
              ${dep.checkout_until? `<div><span class="muted">Avant</span> <strong>${dep.checkout_until}</strong></div>`:''}
              ${(dep.steps||[]).length? `<ul>${dep.steps.map(s=>`<li>${s.label}</li>`).join('')}</ul>`:''}
            </div></div>

            <div class="card"><h2>Infos utiles</h2><div class="content">
              ${ess.electricity? `<div><span class="muted">Électricité</span> ${ess.electricity}</div>`:''}
              ${ess.water? `<div><span class="muted">Eau</span> ${ess.water}</div>`:''}
              ${(ess.emergency||[]).map(c=>`<div><span class="muted">${c.label}</span> ${c.href? `<a href="${c.href}">${c.value}</a>`: c.value}</div>`).join('')}
            </div></div>

            ${ams.length? `<div class="card" style="grid-column:1/-1"><h2>Équipements</h2><div class="content">${ams.map(a=>`<span class="pill">${a.label||''}</span>`).join('')}</div></div>`:''}
          </div>

          ${g.coords? html`<div class="card"><h2>Plan & accès</h2><div class="content">
            <iframe title="map" style="width:100%;height:340px;border:1px solid var(--line);border-radius:12px" loading="lazy" referrerpolicy="no-referrer-when-downgrade"
              src="https://www.google.com/maps?q=${g.coords.lat},${g.coords.lng}&hl=fr&z=15&output=embed"></iframe>
          </div></div>`:''}

          ${g.brand?.supportPhone || g.brand?.supportWhatsApp || g.brand?.supportEmail ? html`<div class="card"><h2>Assistance</h2><div class="content actions">
            ${g.brand?.supportPhone? `<a class="btn" href="tel:${g.brand.supportPhone}">Appeler</a>`:''}
            ${g.brand?.supportWhatsApp? `<a class="btn" target="_blank" rel="noreferrer" href="${g.brand.supportWhatsApp}">WhatsApp 24/7</a>`:''}
            ${g.brand?.supportEmail? `<a class="btn" href="mailto:${g.brand.supportEmail}">Email</a>`:''}
            <button class="btn" onclick="window.print()">Télécharger en PDF</button>
          </div></div>`:''}

          ${g.__sensitive?.token && token !== g.__sensitive.token ? `<div class="warn">Certaines informations sensibles sont masquées. Ajoutez votre jeton à l’URL : <code>?token=VOTRE_TOKEN</code></div>`:''}
        </div>`;
    }

    async function boot(){
      if(!slug){
        root.innerHTML = '<div class="warn">Slug manquant. Utilisez /guide/<em>votre-slug</em></div>';
        return;
      }
      const jsonUrl = `${SUPABASE_URL}/storage/v1/object/public/${GUIDES_BUCKET}/${encodeURIComponent(slug)}.json`;
      try{
        const r = await fetch(jsonUrl, { cache:'no-store' });
        if(!r.ok){
          if(r.status === 404){
            root.innerHTML = `<div class="warn">Guide introuvable pour <b>${slug}</b>.<br>Vérifiez que <code>${jsonUrl}</code> existe dans le bucket <b>${GUIDES_BUCKET}</b>.</div>`;
            return;
          }
          throw new Error(`HTTP ${r.status}`);
        }
        const g = await r.json();
        const title = g?.name || `Guide ${slug}`;
        document.title = `${title} – Conciergerie Zenata`;
        root.innerHTML = html`
          <div class="header" style="padding:0 0 10px 0;">
            <div>
              <div class="badge">Guide</div>
              <h1 style="margin:.2rem 0 0 .0;font-size:28px">${title}</h1>
            </div>
          </div>
          ${section(g)}
        `;
      }catch(e){
        root.innerHTML = `<div class="warn">Erreur de chargement: ${e.message||e}</div>`;
      }
    }

    document.addEventListener('DOMContentLoaded', boot);
  </script>
</body>
</html> -->
<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Guide Voyageur – Conciergerie Zenata</title>
<link rel="icon" href="/logo/logo_officiel_couleur_picto.png"/>

<!-- STYLE PREMIUM -->
<style>
:root {
  --bg1: #0d0e11;
  --bg2: #1a1b1f;
  --accent: #c7a059;
  --ink: #f5f5f5;
  --muted: #a3a3a3;
  --card: rgba(255,255,255,0.04);
  --border: rgba(255,255,255,0.08);
  --radius: 18px;
  --shadow: 0 10px 30px rgba(0,0,0,.5);
}
* {box-sizing:border-box;margin:0;padding:0;}
body {
  font-family: 'Inter', system-ui, sans-serif;
  color: var(--ink);
  background: radial-gradient(1000px 700px at 20% -10%, var(--bg2), var(--bg1) 80%);
  min-height: 100vh;
  padding: 28px;
}
.wrap {max-width:1200px;margin:0 auto;}
.header {display:flex;align-items:center;gap:12px;margin-bottom:18px;}
.header img {height:30px;filter:drop-shadow(0 2px 2px rgba(0,0,0,.4));}
.hero {
  position:relative;overflow:hidden;border-radius:var(--radius);
  height:400px;margin-bottom:30px;border:1px solid var(--border);
  box-shadow:var(--shadow);
}
.hero img {width:100%;height:100%;object-fit:cover;filter:brightness(.85);}
.hero .overlay {position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,0) 50%,rgba(0,0,0,.65) 100%);}
.hero .title {
  position:absolute;bottom:24px;left:28px;right:28px;color:#fff;
}
.hero .title h1 {margin:0;font-size:34px;font-weight:700;letter-spacing:.3px;}
.hero .title .badge {
  background:rgba(0,0,0,.4);
  border:1px solid rgba(255,255,255,.2);
  color:#fff;
  font-size:12px;
  border-radius:999px;
  padding:4px 10px;
  display:inline-block;
  margin-bottom:8px;
}

/* GRID DES CARTES */
.grid {
  display:grid;
  gap:18px;
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  margin-bottom:40px;
}
.tile {
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  backdrop-filter:blur(10px);
  padding:28px 20px;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  cursor:pointer;transition:all .25s ease;
  text-align:center;
}
.tile:hover {
  transform:translateY(-3px);
  background:rgba(255,255,255,0.08);
}
.tile svg {
  width:34px;height:34px;margin-bottom:12px;stroke:var(--accent);stroke-width:1.7;
}
.tile span {font-size:15px;font-weight:600;letter-spacing:.3px;}

/* MODALE */
.modal {
  position:fixed;inset:0;background:rgba(0,0,0,.55);
  display:none;align-items:center;justify-content:center;padding:24px;z-index:50;
}
.modal[open]{display:flex;}
.modal-card {
  background:linear-gradient(180deg,#121317 0%,#0d0e11 100%);
  border:1px solid var(--border);
  border-radius:var(--radius);
  max-width:680px;width:100%;
  box-shadow:var(--shadow);
  color:#f8f8f8;
}
.modal-head {
  display:flex;align-items:center;justify-content:space-between;
  border-bottom:1px solid var(--border);
  padding:16px 20px;
}
.modal-head strong {font-size:18px;}
.modal-close {
  background:transparent;border:1px solid var(--border);
  border-radius:999px;color:#ccc;padding:6px 12px;cursor:pointer;
}
.modal-body {padding:24px;font-size:15px;line-height:1.6;}
.modal-body ul{margin-left:20px;margin-top:10px}
.modal-body li{margin-bottom:6px;}
.footer {
  text-align:center;
  color:var(--muted);
  margin-top:60px;
  font-size:13px;
  letter-spacing:.2px;
}
</style>
</head>

<body>
<div class="wrap">
  <div class="header">
    <img src="/logo/logo_officiel_couleur_picto.png" alt="Zenata Logo">
    <strong>Conciergerie Zenata</strong>
  </div>

  <div id="hero" class="hero" style="display:none">
    <img id="hero-img" alt="">
    <div class="overlay"></div>
    <div class="title">
      <div class="badge">Guide voyageur</div>
      <h1 id="title"></h1>
    </div>
  </div>

  <div id="grid" class="grid"></div>

  <div class="footer">© <span id="year"></span> Conciergerie Zenata — Séjour Premium</div>
</div>

<!-- Modale -->
<div id="modal" class="modal" aria-hidden="true">
  <div class="modal-card">
    <div class="modal-head">
      <strong id="m-title">Détail</strong>
      <button class="modal-close" id="m-close">Fermer</button>
    </div>
    <div class="modal-body" id="m-body"></div>
  </div>
</div>

<script>
const SUPABASE_URL="https://ojgchrqtvkwzhjvwwftd.supabase.co";
const BUCKET="guides";
document.getElementById("year").textContent=new Date().getFullYear();

function openModal(t,html){
  document.getElementById('m-title').textContent=t;
  document.getElementById('m-body').innerHTML=html;
  document.getElementById('modal').setAttribute('open','');
}
function closeModal(){document.getElementById('modal').removeAttribute('open');}
document.getElementById('m-close').onclick=closeModal;
document.getElementById('modal').addEventListener('click',e=>{if(e.target.id==='modal')closeModal();});

function icon(name){
  const icons={
    wifi:`<svg fill="none" viewBox="0 0 24 24"><path d="M5 12a9 9 0 0114 0M2 9a12 12 0 0120 0M8.5 15.5a5 5 0 017 0M12 20h.01"/></svg>`,
    door:`<svg fill="none" viewBox="0 0 24 24"><path d="M14 12v.01M6 3h12v18H6z"/></svg>`,
    checkin:`<svg fill="none" viewBox="0 0 24 24"><path d="M3 3h18v18H3zM8 12l2 2 5-5"/></svg>`,
    map:`<svg fill="none" viewBox="0 0 24 24"><path d="M9 3l6 3 6-3v18l-6 3-6-3-6 3V3l6-3z"/></svg>`,
    rules:`<svg fill="none" viewBox="0 0 24 24"><path d="M5 5h14M5 9h14M5 13h9M5 17h9"/></svg>`,
    amenities:`<svg fill="none" viewBox="0 0 24 24"><path d="M4 6h16v12H4z"/></svg>`,
    help:`<svg fill="none" viewBox="0 0 24 24"><path d="M9 9a3 3 0 116 0c0 1.657-3 3-3 3m0 4h.01"/></svg>`,
    exit:`<svg fill="none" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4m7 4l5 5-5 5m5-5H9"/></svg>`,
  };
  return icons[name]||icons.map;
}

async function boot(){
  const slug=(location.pathname.split('/').pop()||'').replace(/\.html$/,'');
  const token=new URLSearchParams(location.search).get('token')||'';
  const url=`${SUPABASE_URL}/storage/v1/object/public/${BUCKET}/${slug}.json`;
  let g;
  try{const r=await fetch(url);if(!r.ok)throw new Error();g=await r.json();}
  catch{document.body.innerHTML='<div style="color:white;text-align:center;padding:50px">Guide introuvable.</div>';return;}

  // Hero
  if(g.cover?.imageUrl){
    document.getElementById('hero-img').src=g.cover.imageUrl;
    document.getElementById('hero').style.display='';
  }
  document.getElementById('title').textContent=g.name||'';

  const allow = g.__sensitive?.token ? (token===g.__sensitive.token) : true;
  const a=g.arrival?.fr||{};
  const rules=g.rules?.fr?.items||[];
  const ams=g.amenities||[];

  const grid=document.getElementById('grid');
  const cards=[
    {key:'Adresse',icon:'map',content:`<p>${g.address||''}</p>`},
    {key:'Wi-Fi',icon:'wifi',content:`<p><b>SSID:</b> ${a.wifi?.ssid||''}<br><b>Mot de passe:</b> ${a.wifi?.password||''}</p>`},
    {key:'Code porte',icon:'door',content: allow ? `<p style="font-size:28px"><b>${a.doorCode||''}</b></p>`:`<p>Informations sensibles masquées.<br>Ajoutez votre token : ?token=VOTRE_TOKEN</p>`},
    {key:'Check-in',icon:'checkin',content:`<p>À partir de <b>${a.checkin_from||''}</b></p>${a.parking?`<p><b>Parking:</b> ${a.parking}</p>`:''}`},
    {key:'Règles',icon:'rules',content:rules.length?`<ul>${rules.map(r=>`<li>${r}</li>`).join('')}</ul>`:`<p>Aucune règle.</p>`},
    {key:'Équipements',icon:'amenities',content:ams.length?ams.map(a=>`<span style="display:inline-block;margin:4px 6px 0 0;padding:6px 10px;border:1px solid rgba(255,255,255,.1);border-radius:999px;">${a.label}</span>`).join(''):`<p>Non renseigné.</p>`},
    {key:'Essentiels',icon:'map',content:`<p>${(g.essentials?.fr||'').replace(/\n/g,'<br>')}</p>`},
    {key:'Départ',icon:'exit',content:`<p>Check-out avant <b>${g.departure?.fr?.checkout_until||'11:00'}</b></p>`},
    {key:'Assistance',icon:'help',content:`<p><b>Email :</b> <a href="mailto:${g.brand?.supportEmail||'hello@conciergeriezenata.com'}">${g.brand?.supportEmail||''}</a><br><b>Site :</b> <a href="${g.brand?.site||'#'}" target="_blank">${g.brand?.site||''}</a></p>`},
  ];

  for(const c of cards){
    const d=document.createElement('div');
    d.className='tile';
    d.innerHTML=`${icon(c.icon)}<span>${c.key}</span>`;
    d.onclick=()=>openModal(c.key,c.content);
    grid.appendChild(d);
  }
}
document.addEventListener('DOMContentLoaded',boot);
</script>
</body>
</html>
