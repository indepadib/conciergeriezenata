<!--
Guide public premium – version statique sans build
- Fichier: guide.html à placer à la racine du repo (à côté de index.html)
- URL finale: https://conciergeriezenata.com/guide/<slug>
- Nécessite un fichier _redirects (à la racine) avec:
    /guide/*   /guide.html?slug=:splat   200

- Lit le JSON public dans Supabase Storage: https://<SUPABASE_URL>/storage/v1/object/public/guides/<slug>.json
- Gestion du token: /guide/<slug>?token=XXXX pour afficher les champs sensibles
- Aucun framework, aucune clé d'API requise pour la lecture (public)

<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Guide Voyageur – Conciergerie Zenata</title>
  <meta name="theme-color" content="#0f172a"/>
  <style>
    :root{--ink:#0f172a;--muted:#475569;--line:#e2e8f0;--bg:#ffffff;--card:#f8fafc;--brand:#111827}
    *{box-sizing:border-box}html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--ink);background:var(--bg)}
    .container{max-width:1120px;margin:0 auto;padding:20px}
    .header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 0}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .brand img{height:28px}
    .badge{font-size:12px;color:var(--muted)}
    .hero{border-radius:20px;overflow:hidden;border:1px solid var(--line);background:#000}
    .hero img{width:100%;height:420px;object-fit:cover;display:block;opacity:.95}
    .grid{display:grid;gap:16px}
    .grid-3{grid-template-columns:1fr 1fr 1fr}
    .grid-2{grid-template-columns:1.15fr .85fr}
    @media(max-width:960px){.grid-2,.grid-3{grid-template-columns:1fr}}
    .tile{border:1px solid var(--line);border-radius:14px;padding:12px;background:#fff}
    .tile .k{font-size:12px;color:var(--muted)}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;overflow:hidden}
    .card h2{margin:0;padding:12px 14px;border-bottom:1px solid var(--line);font-size:16px}
    .card .content{padding:16px}
    ul{margin:8px 0;padding-left:18px}
    .pill{display:inline-flex;gap:6px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;font-size:12px;margin:4px 6px 0 0;background:#fff}
    .muted{color:var(--muted)}
    .warn{background:#fffbeb;border:1px solid #fef3c7;color:#92400e;padding:10px 12px;border-radius:12px;font-size:13px}
    .footer{padding:28px 0;text-align:center;color:var(--muted);font-size:12px}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid var(--line);background:#fff;border-radius:12px;padding:10px 14px;cursor:pointer}
    .btn.primary{background:var(--brand);color:#fff;border-color:var(--brand)}
    .sr{position:absolute;left:-9999px}
    .hidden{display:none}
  </style>
</head>
<body>
  <header class="container header">
    <div class="brand"><img src="/logo/logo_officiel_couleur_picto.png" alt="CZ"> Conciergerie Zenata</div>
    <div class="badge" id="guideSlug"></div>
  </header>

  <main class="container" id="root">
    <p class="muted">Chargement du guide…</p>
  </main>

  <footer class="container footer">© <span id="year"></span> Conciergerie Zenata</footer>

  <script>
    // === CONFIG — mets simplement ton URL Supabase ici ===
    const SUPABASE_URL = "https://ojgchrqtvkwzhjvwwftd.supabase.co"; // <- la tienne
    const GUIDES_BUCKET = "guides";

    const qs = new URL(location.href);
    const slug = (qs.searchParams.get('slug') || location.pathname.split('/').filter(Boolean).pop() || '').trim();
    const token = qs.searchParams.get('token') || '';

    document.getElementById('year').textContent = new Date().getFullYear();
    document.getElementById('guideSlug').textContent = slug ? `#${slug}` : '';

    const root = document.getElementById('root');

    function html(strings, ...vals){ return strings.map((s,i)=>s+(vals[i]??'')).join(''); }

    function section(g){
      const a = g.arrival?.fr || {};
      const allow = g.__sensitive?.token ? (token === g.__sensitive.token) : true;
      const door = allow ? (a.doorCode||'') : '•••• (masqué)';
      const rules = g.rules?.fr?.items || [];
      const dep = g.departure?.fr || {};
      const ess = g.essentials?.fr || {};
      const ams = g.amenities || [];

      return html`
        <div class="grid" style="gap:18px">
          <div class="hero"><img alt="${g.name||''}" src="${g.cover?.imageUrl||''}"></div>

          <div class="grid grid-3">
            <div class="tile"><div class="k">Adresse</div><div><strong>${g.address||''}</strong></div></div>
            <div class="tile"><div class="k">Wi‑Fi</div><div><strong>${(a.wifi?.ssid||'')}${a.wifi?.password? ' • '+a.wifi.password: ''}</strong></div></div>
            <div class="tile"><div class="k">Code porte</div><div><strong>${door}</strong></div></div>
          </div>

          <div class="grid grid-2">
            <div class="card"><h2>Arrivée & Check‑in</h2><div class="content">
              <div><span class="muted">À partir de</span> <strong>${a.checkin_from||''}</strong></div>
              ${a.parking? `<div><span class="muted">Parking</span> <strong>${a.parking}</strong></div>`:''}
              ${(a.notes||[]).length? `<ul>${(a.notes||[]).map(n=>`<li>${n}</li>`).join('')}</ul>`:''}
            </div></div>

            <div class="card"><h2>Règles</h2><div class="content"><ul>${rules.map(r=>`<li>${r}</li>`).join('')}</ul></div></div>

            <div class="card"><h2>Départ & Check‑out</h2><div class="content">
              ${dep.checkout_until? `<div><span class="muted">Avant</span> <strong>${dep.checkout_until}</strong></div>`:''}
              ${(dep.steps||[]).length? `<ul>${dep.steps.map(s=>`<li>${s.label}</li>`).join('')}</ul>`:''}
            </div></div>

            <div class="card"><h2>Infos utiles</h2><div class="content">
              ${ess.electricity? `<div><span class="muted">Électricité</span> ${ess.electricity}</div>`:''}
              ${ess.water? `<div><span class="muted">Eau</span> ${ess.water}</div>`:''}
              ${(ess.emergency||[]).map(c=>`<div><span class="muted">${c.label}</span> ${c.href? `<a href="${c.href}">${c.value}</a>`: c.value}</div>`).join('')}
            </div></div>

            ${ams.length? `<div class="card" style="grid-column:1/-1"><h2>Équipements</h2><div class="content">${ams.map(a=>`<span class="pill">${a.label||''}</span>`).join('')}</div></div>`:''}
          </div>

          ${g.coords? html`<div class="card"><h2>Plan & accès</h2><div class="content">
            <iframe title="map" style="width:100%;height:340px;border:1px solid var(--line);border-radius:12px" loading="lazy" referrerpolicy="no-referrer-when-downgrade"
              src="https://www.google.com/maps?q=${g.coords.lat},${g.coords.lng}&hl=fr&z=15&output=embed"></iframe>
          </div></div>`:''}

          ${g.brand?.supportPhone || g.brand?.supportWhatsApp || g.brand?.supportEmail ? html`<div class="card"><h2>Assistance</h2><div class="content actions">
            ${g.brand?.supportPhone? `<a class="btn" href="tel:${g.brand.supportPhone}">Appeler</a>`:''}
            ${g.brand?.supportWhatsApp? `<a class="btn" target="_blank" rel="noreferrer" href="${g.brand.supportWhatsApp}">WhatsApp 24/7</a>`:''}
            ${g.brand?.supportEmail? `<a class="btn" href="mailto:${g.brand.supportEmail}">Email</a>`:''}
            <button class="btn" onclick="window.print()">Télécharger en PDF</button>
          </div></div>`:''}

          ${g.__sensitive?.token && token !== g.__sensitive.token ? `<div class="warn">Certaines informations sensibles sont masquées. Ajoutez votre jeton à l’URL : <code>?token=VOTRE_TOKEN</code></div>`:''}
        </div>`;
    }

    async function boot(){
      if(!slug){
        root.innerHTML = '<div class="warn">Slug manquant. Utilisez /guide/<em>votre-slug</em></div>';
        return;
      }
      const jsonUrl = `${SUPABASE_URL}/storage/v1/object/public/${GUIDES_BUCKET}/${encodeURIComponent(slug)}.json`;
      try{
        const r = await fetch(jsonUrl, { cache:'no-store' });
        if(!r.ok){
          if(r.status === 404){
            root.innerHTML = `<div class="warn">Guide introuvable pour <b>${slug}</b>.<br>Vérifiez que <code>${jsonUrl}</code> existe dans le bucket <b>${GUIDES_BUCKET}</b>.</div>`;
            return;
          }
          throw new Error(`HTTP ${r.status}`);
        }
        const g = await r.json();
        const title = g?.name || `Guide ${slug}`;
        document.title = `${title} – Conciergerie Zenata`;
        root.innerHTML = html`
          <div class="header" style="padding:0 0 10px 0;">
            <div>
              <div class="badge">Guide</div>
              <h1 style="margin:.2rem 0 0 .0;font-size:28px">${title}</h1>
            </div>
          </div>
          ${section(g)}
        `;
      }catch(e){
        root.innerHTML = `<div class="warn">Erreur de chargement: ${e.message||e}</div>`;
      }
    }

    document.addEventListener('DOMContentLoaded', boot);
  </script>
</body>
</html> -->
<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Guide Voyageur – Conciergerie Zenata</title>
  <link rel="icon" href="/logo/logo_officiel_couleur_picto.png"/>
  <meta name="theme-color" content="#0F172A">
  <meta property="og:title" content="Guide Voyageur – Conciergerie Zenata">
  <meta property="og:description" content="Toutes les informations utiles pour votre séjour.">
  <meta property="og:image" content="/logo/logo_officiel_couleur_picto.png">

  <style>
    :root{
      /* Couleurs signature (luxe clair) */
      --ink:#0B1220; --muted:#6F7782; --line:#E4E9F2; --card:#FFFFFF;
      --brand:#0F172A; --gold:#C6A86A; /* or discret */
      --r-xl:26px; --r-lg:18px; --r-md:12px;
      --shadow:0 24px 64px rgba(16,24,40,.12), 0 8px 24px rgba(16,24,40,.06);
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--ink);
      /* Halo premium : subtil, multi-couches */
      background:
        radial-gradient(1200px 700px at 12% -15%, #ffffff 0%, #f6f8fb 45%, transparent 60%),
        radial-gradient(900px 520px at 110% -15%, #f2f5fa 0%, transparent 60%),
        linear-gradient(180deg,#f8fafc 0%, #eef3f8 100%);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      min-height:100vh;
    }
    .container{max-width:1140px;margin:0 auto;padding:22px}

    /* NAV – verre + blur + logo */
    .nav{
      position:sticky; top:0; z-index:60;
      background:rgba(255,255,255,.88);
      backdrop-filter:saturate(180%) blur(14px);
      border-bottom:1px solid var(--line);
    }
    .nav-row{display:flex;align-items:center;gap:14px}
    .brand{display:flex;align-items:center;gap:12px;font-weight:800;letter-spacing:.25px}
    .brand img{height:28px}
    .brand span{font-size:15px}
    .nav-actions{margin-left:auto;display:flex;gap:10px}
    .btn{
      appearance:none; cursor:pointer;
      border:1px solid var(--line); background:#fff; color:var(--ink);
      border-radius:12px; padding:9px 14px; font-weight:600; font-size:13px;
      transition:box-shadow .2s ease, transform .08s ease, border-color .2s ease;
    }
    .btn:hover{box-shadow:0 6px 14px rgba(16,24,40,.08)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{
      background:linear-gradient(135deg, var(--brand), #1F2937);
      color:#fff; border:none;
    }

    /* HERO – image, badge logo, titre */
    .hero{
      position:relative; overflow:hidden;
      border:1px solid var(--line); border-radius:var(--r-xl); box-shadow:var(--shadow);
    }
    .hero img{width:100%; height:440px; object-fit:cover; display:block}
    .hero .overlay{position:absolute; inset:0; background:linear-gradient(180deg, rgba(0,0,0,0) 42%, rgba(0,0,0,.62) 100%)}
    .hero-badge{
      position:absolute; top:18px; left:18px; z-index:2;
      width:46px; height:46px; border-radius:14px; overflow:hidden; display:grid; place-items:center;
      background:radial-gradient(120% 120% at 30% 20%, #ffffff 0%, #f3f5f8 100%);
      border:1px solid rgba(16,24,40,.10); box-shadow:0 10px 24px rgba(16,24,40,.16);
    }
    .hero-badge img{width:28px; height:28px; object-fit:contain; opacity:.95}
    .hero .title{position:absolute; left:22px; right:22px; bottom:18px; color:#fff}
    .hero .k{font-size:12px; opacity:.95}
    .hero h1{margin:.25rem 0 0; font-size:30px; letter-spacing:.2px; text-shadow:0 3px 12px rgba(0,0,0,.35)}

    /* Deck cartes – verre + micro accent or */
    .deck{display:grid; grid-template-columns:repeat(auto-fit, minmax(230px, 1fr)); gap:16px; margin-top:18px}
    .c-card{
      position:relative; cursor:pointer; border-radius:18px; padding:16px 16px 18px 60px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.82)),
        radial-gradient(130% 130% at 110% -10%, rgba(198,168,106,.10), transparent 60%);
      border:1px solid rgba(16,24,40,.10);
      box-shadow:0 12px 24px rgba(16,24,40,.07), 0 28px 56px rgba(16,24,40,.08);
      transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease;
    }
    .c-card:hover{transform:translateY(-3px); border-color:rgba(16,24,40,.16); box-shadow:0 22px 46px rgba(16,24,40,.12)}
    .c-icon{
      position:absolute; left:14px; top:14px; width:34px; height:34px; border-radius:12px; display:grid; place-items:center;
      background:radial-gradient(100% 100% at 50% 0%, #ffffff 0%, #f1f3f7 100%); border:1px solid rgba(16,24,40,.08);
      box-shadow:inset 0 8px 18px rgba(16,24,40,.08);
    }
    .c-icon svg{width:18px; height:18px; opacity:.9}
    .c-title{font-weight:800; letter-spacing:.2px}
    .c-hint{font-size:12px; color:var(--muted); margin-top:2px}

    /* Sections complémentaires */
    .section{margin-top:18px}
    .card{background:#fff; border:1px solid var(--line); border-radius:var(--r-lg); box-shadow:var(--shadow); overflow:hidden}
    .card h2{margin:0; padding:14px 16px; border-bottom:1px solid var(--line); font-size:16px; letter-spacing:.2px}
    .content{padding:16px}
    .pill{display:inline-flex; gap:6px; padding:6px 10px; border:1px solid var(--line); border-radius:999px; font-size:12px; margin:4px 6px 0 0; background:#fff}

    /* Skeleton loader */
    .skeleton{border-radius:18px; height:220px; background:linear-gradient(90deg,#eef2f7 25%,#f6f8fb 37%,#eef2f7 63%); background-size:400% 100%; animation:sk 1.4s ease infinite}
    .skeleton + .skeleton{height:120px; margin-top:12px}
    @keyframes sk{0%{background-position:100% 0}100%{background-position:0 0}}

    /* Modal premium */
    .modal{position:fixed; inset:0; display:none; place-items:center; padding:24px; z-index:70}
    .modal.open{display:grid}
    .modal::before{content:""; position:absolute; inset:0; backdrop-filter:blur(10px); background:rgba(10,14,22,.38)}
    .modal-card{position:relative; width:min(760px,92vw); max-height:80vh; overflow:auto; background:#fff; border:1px solid var(--line); border-radius:18px; box-shadow:0 24px 64px rgba(16,24,40,.22); animation:fade .22s ease}
    @keyframes fade{from{opacity:0; transform:translateY(10px)}to{opacity:1; transform:translateY(0)}}
    .modal-head{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:14px 16px; border-bottom:1px solid var(--line); background:#f9fafb; position:sticky; top:0; z-index:1}
    .modal-body{padding:18px; font-size:15px; line-height:1.6}
    .modal-close{appearance:none; background:#fff; border:1px solid #d1d5db; border-radius:10px; padding:8px 12px; cursor:pointer}
    .modal-close:hover{background:#f1f5f9}

    .foot{margin:34px 0 12px; color:var(--muted); font-size:12px; text-align:center}

    @media print{
      .nav,.btn{display:none}
      .hero img{height:300px}
      .c-card{box-shadow:none}
    }
  </style>
</head>
<body>

  <!-- NAV -->
  <header class="nav">
    <div class="container nav-row">
      <div class="brand">
        <img src="/logo/logo_officiel_couleur_picto.png" alt="Conciergerie Zenata">
        <span>Conciergerie Zenata</span>
      </div>
      <div class="nav-actions">
        <button class="btn" id="copyLink">Copier le lien</button>
        <button class="btn" id="qrBtn">QR</button>
        <button class="btn primary" id="dlPdf">Télécharger PDF</button>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="container" id="root">
    <div class="skeleton"></div>
    <div class="skeleton"></div>
  </main>

  <!-- MODAL -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-head">
        <strong id="m-title">Détail</strong>
        <button class="modal-close" id="m-close">Fermer</button>
      </div>
      <div class="modal-body" id="m-body"></div>
    </div>
  </div>

  <div class="foot">© <span id="y"></span> Conciergerie Zenata — Guide Voyageur</div>

  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    /* Config lecture */
    const SUPABASE_URL = "https://ojgchrqtvkwzhjvwwftd.supabase.co";
    const BUCKET = "guides";
    const token = new URLSearchParams(location.search).get("token") || "";

    /* Helpers */
    function b64(s){ return btoa(unescape(encodeURIComponent(s))).replace(/=/g,""); }
    function icon(name){
      const i={
        map:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18-6 3V6l6-3 6 3 6-3v15l-6 3-6-3Z"/><path d="M9 3v15"/><path d="M15 6v15"/></svg>`,
        wifi:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h.01"/><path d="M2 8.82a15 15 0 0 1 20 0"/><path d="M5 12.5a10 10 0 0 1 14 0"/><path d="M8.5 16.2a5 5 0 0 1 7 0"/></svg>`,
        key:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10a7 7 0 1 1-14 0 7 7 0 0 1 14 0Z"/><path d="m8 21 3-3"/><path d="m10.5 18.5 3-3"/></svg>`,
        clock:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>`,
        rules:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 6h13M8 12h13M8 18h13"/><path d="M3 6h.01M3 12h.01M3 18h.01"/></svg>`,
        phone:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.8 19.8 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.8 19.8 0 0 1 2.08 4.18 2 2 0 0 1 4 2h3a2 2 0 0 1 2 1.72c.12.9.33 1.78.63 2.63a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.45-1.08a2 2 0 0 1 2.11-.45c.85.3 1.73.51 2.63.63A2 2 0 0 1 22 16.92z"/></svg>`
      }; return i[name]||i.map;
    }

    function card({iconName, title, hint, detailHtml}){
      const uid = b64(title + (hint||""));
      return `
        <div class="c-card" data-modal="${uid}" role="button" tabindex="0" aria-label="${title}">
          <div class="c-icon">${icon(iconName)}</div>
          <div class="c-title">${title}</div>
          <div class="c-hint">${hint || "Voir les détails"}</div>
          <template id="tpl-${uid}">${detailHtml}</template>
        </div>`;
    }

    function hero(g){
      const logo = "/logo/logo_officiel_couleur_picto.png";
      return `
        <section class="hero">
          <img src="${g.cover?.imageUrl || ""}" alt="${g.name||""}">
          <div class="overlay"></div>
          <div class="hero-badge"><img src="${logo}" alt="CZ"></div>
          <div class="title">
            <div class="k">Guide voyageur</div>
            <h1>${g.name || "Sans titre"}</h1>
          </div>
        </section>`;
    }

    /* Modal */
    function openModal(t,h){ const m=document.getElementById("modal"); document.getElementById("m-title").textContent=t; document.getElementById("m-body").innerHTML=h; m.classList.add("open"); m.setAttribute("aria-hidden","false"); }
    function closeModal(){ const m=document.getElementById("modal"); m.classList.remove("open"); m.setAttribute("aria-hidden","true"); }
    document.getElementById("m-close").onclick = closeModal;
    document.getElementById("modal").onclick = (e)=>{ if(e.target.id==="modal") closeModal(); }

    function wireCards(){
      document.querySelectorAll("[data-modal]").forEach(el=>{
        el.addEventListener("click", ()=>{
          const id = el.dataset.modal;
          const t  = el.querySelector(".c-title")?.textContent?.trim() || "Détail";
          const tpl= document.getElementById("tpl-"+id);
          openModal(t, tpl? tpl.innerHTML : "");
        });
        el.addEventListener("keypress", (e)=>{ if(e.key==="Enter"||e.key===" ") el.click(); });
      });
    }

    /* Actions nav */
    document.getElementById('dlPdf').onclick = ()=> window.print();
    document.getElementById('copyLink').onclick = async ()=>{
      try{ await navigator.clipboard.writeText(location.href);
        const b = document.getElementById('copyLink'); const t = b.textContent; b.textContent = 'Lien copié'; setTimeout(()=> b.textContent=t, 1200);
      }catch{}
    };
    document.getElementById('qrBtn').onclick = ()=>{
      const url = encodeURIComponent(location.href);
      const img = `https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=${url}`;
      openModal('Partager ce guide', `<div style="display:grid;place-items:center;gap:10px">
        <img src="${img}" alt="QR" width="220" height="220" style="border-radius:12px;border:1px solid var(--line)"/>
        <div class="c-hint">Scannez pour ouvrir</div>
      </div>`);
    };

    async function boot(){
      const root = document.getElementById("root");

      // Récup slug via path /guide/<slug> ou ?slug=
      let slug = new URL(location.href).searchParams.get("slug");
      if(!slug){
        const parts = location.pathname.split("/").filter(Boolean);
        slug = parts[parts.length-1] || "";
      }
      if(!slug){ root.innerHTML = `<div class="card"><h2>Slug manquant</h2><div class="content">URL attendue : <code>/guide/&lt;slug&gt;</code></div></div>`; return; }

      const jsonUrl = `${SUPABASE_URL}/storage/v1/object/public/${BUCKET}/${encodeURIComponent(slug)}.json`;

      try{
        const r = await fetch(jsonUrl, { cache:"no-store" });
        if(!r.ok){
          root.innerHTML = `<div class="card"><h2>Guide introuvable</h2><div class="content">
            <p>Fichier <code>${slug}.json</code> non trouvé dans le bucket <b>${BUCKET}</b>.</p>
            <p><a class="btn" href="/admin-guides.html?slug=${slug}">Créer/éditer ce guide</a></p>
          </div></div>`;
          return;
        }
        const g = await r.json();
        document.title = `${g?.name || "Guide"} – Conciergerie Zenata`;

        /* HERO */
        const top = hero(g);

        /* Cartes */
        const a = g.arrival?.fr || {};
        const allow = g.__sensitive?.token ? (token === g.__sensitive.token) : true;
        const door  = allow ? (a.doorCode||"") : "•••• (masqué)";

        const cards = [];

        if (g.address) cards.push(card({
          iconName:"map", title:"Adresse", hint:"Cliquez pour l’adresse complète",
          detailHtml:`<p style="margin-bottom:10px"><strong>${g.address}</strong></p>
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <a class="btn" target="_blank" rel="noreferrer" href="https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(g.address)}">Itinéraire</a>
            </div>`
        }));

        if (a.wifi?.ssid || a.wifi?.password) cards.push(card({
          iconName:"wifi", title:"Wi-Fi", hint:"SSID & mot de passe",
          detailHtml:`<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:10px">
            <div class="pill"><span style="opacity:.7">Réseau</span>&nbsp;<b>${a.wifi?.ssid||""}</b></div>
            <div class="pill"><span style="opacity:.7">Mot de passe</span>&nbsp;<b>${a.wifi?.password||""}</b></div>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn" onclick="navigator.clipboard.writeText('${a.wifi?.password||''}')">Copier le mot de passe</button>
            <img src="https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=${encodeURIComponent(`WIFI:T:WPA;S:${a.wifi?.ssid||''};P:${a.wifi?.password||''};;`)}" alt="QR Wi-Fi" width="160" height="160" style="border:1px solid var(--line);border-radius:12px">
          </div>`
        }));

        if (door) cards.push(card({
          iconName:"key", title:"Code porte", hint: allow ? "Cliquez pour afficher" : "Masqué – token requis",
          detailHtml:`<div style="font-size:22px"><b>${door}</b></div>
            ${!allow?`<p style="margin-top:8px;color:#9aa3ad">Ajoutez <code>?token=VOTRE_TOKEN</code> à l’URL pour révéler le code.</p>`:""}`
        }));

        if (a.checkin_from) cards.push(card({
          iconName:"clock", title:"Arrivée / Check-in",
          hint: a.parking ? `Parking : ${a.parking}` : `Dès ${a.checkin_from}`,
          detailHtml:`${a.checkin_from?`<p><span style="opacity:.7">À partir de</span> : <b>${a.checkin_from}</b></p>`:""}
                     ${a.parking?`<p><span style="opacity:.7">Parking</span> : <b>${a.parking}</b></p>`:""}
                     ${(a.notes||[]).length?`<ul style="margin-top:8px">${a.notes.map(n=>`<li>${n}</li>`).join("")}</ul>`:""}`
        }));

        const rules = g.rules?.fr?.items || [];
        if (rules.length) cards.push(card({
          iconName:"rules", title:"Règles du logement", hint:`${rules.length} règle${rules.length>1?"s":""}`,
          detailHtml:`<ul>${rules.map(r=>`<li>${r}</li>`).join("")}</ul>`
        }));

        if (g.brand?.supportPhone || g.brand?.supportWhatsApp || g.brand?.supportEmail) cards.push(card({
          iconName:"phone", title:"Assistance 24/7", hint:"Contacter l’hôte",
          detailHtml:`<div style="display:flex;gap:8px;flex-wrap:wrap">
            ${g.brand?.supportPhone ? `<a class="btn" href="tel:${g.brand.supportPhone}">📞 Appeler</a>` : ""}
            ${g.brand?.supportWhatsApp ? `<a class="btn" target="_blank" rel="noreferrer" href="${g.brand.supportWhatsApp}">💬 WhatsApp</a>` : ""}
            ${g.brand?.supportEmail ? `<a class="btn" href="mailto:${g.brand.supportEmail}">✉️ Email</a>` : ""}
          </div>
          <div class="c-hint" style="margin-top:6px">Disponibilité : 8h–22h (GMT+1)</div>`
        }));

        const deck = `<section class="deck">${cards.join("")}</section>`;

        /* Sections optionnelles */
        const dep = g.departure?.fr || {};
        const ams = g.amenities || [];
        const extras = `
          ${(dep.checkout_until)?`
            <div class="section">
              <div class="card">
                <h2>Départ & Check-out</h2>
                <div class="content">Avant <b>${dep.checkout_until}</b></div>
              </div>
            </div>`:""}
          ${(ams||[]).length?`
            <div class="section">
              <div class="card">
                <h2>Équipements</h2>
                <div class="content">${ams.map(a=>`<span class="pill">${a.label||a}</span>`).join("")}</div>
              </div>
            </div>`:""}
        `;

        const signature = `
          <div class="container" style="margin:-6px 0 2px 0; color:#8a8f98; font-size:13px;">
            Service 5★ by Conciergerie Zenata — arrivée autonome, qualité hôtelière, assistance 24/7.
          </div>`;

        root.innerHTML = top + signature + deck + extras;
        wireCards();

      }catch(e){
        root.innerHTML = `<div class="card"><h2>Erreur</h2><div class="content"><p style="color:#b91c1c">${e.message||e}</p></div></div>`;
      }
    }

    document.addEventListener("DOMContentLoaded", boot);
  </script>
</body>
</html>
