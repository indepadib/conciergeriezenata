<!--
Guide public premium – version statique sans build
- Fichier: guide.html à placer à la racine du repo (à côté de index.html)
- URL finale: https://conciergeriezenata.com/guide/<slug>
- Nécessite un fichier _redirects (à la racine) avec:
    /guide/*   /guide.html?slug=:splat   200

- Lit le JSON public dans Supabase Storage: https://<SUPABASE_URL>/storage/v1/object/public/guides/<slug>.json
- Gestion du token: /guide/<slug>?token=XXXX pour afficher les champs sensibles
- Aucun framework, aucune clé d'API requise pour la lecture (public)

<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Guide Voyageur – Conciergerie Zenata</title>
  <meta name="theme-color" content="#0f172a"/>
  <style>
    :root{--ink:#0f172a;--muted:#475569;--line:#e2e8f0;--bg:#ffffff;--card:#f8fafc;--brand:#111827}
    *{box-sizing:border-box}html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--ink);background:var(--bg)}
    .container{max-width:1120px;margin:0 auto;padding:20px}
    .header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 0}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .brand img{height:28px}
    .badge{font-size:12px;color:var(--muted)}
    .hero{border-radius:20px;overflow:hidden;border:1px solid var(--line);background:#000}
    .hero img{width:100%;height:420px;object-fit:cover;display:block;opacity:.95}
    .grid{display:grid;gap:16px}
    .grid-3{grid-template-columns:1fr 1fr 1fr}
    .grid-2{grid-template-columns:1.15fr .85fr}
    @media(max-width:960px){.grid-2,.grid-3{grid-template-columns:1fr}}
    .tile{border:1px solid var(--line);border-radius:14px;padding:12px;background:#fff}
    .tile .k{font-size:12px;color:var(--muted)}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;overflow:hidden}
    .card h2{margin:0;padding:12px 14px;border-bottom:1px solid var(--line);font-size:16px}
    .card .content{padding:16px}
    ul{margin:8px 0;padding-left:18px}
    .pill{display:inline-flex;gap:6px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;font-size:12px;margin:4px 6px 0 0;background:#fff}
    .muted{color:var(--muted)}
    .warn{background:#fffbeb;border:1px solid #fef3c7;color:#92400e;padding:10px 12px;border-radius:12px;font-size:13px}
    .footer{padding:28px 0;text-align:center;color:var(--muted);font-size:12px}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid var(--line);background:#fff;border-radius:12px;padding:10px 14px;cursor:pointer}
    .btn.primary{background:var(--brand);color:#fff;border-color:var(--brand)}
    .sr{position:absolute;left:-9999px}
    .hidden{display:none}
  </style>
</head>
<body>
  <header class="container header">
    <div class="brand"><img src="/logo/logo_officiel_couleur_picto.png" alt="CZ"> Conciergerie Zenata</div>
    <div class="badge" id="guideSlug"></div>
  </header>

  <main class="container" id="root">
    <p class="muted">Chargement du guide…</p>
  </main>

  <footer class="container footer">© <span id="year"></span> Conciergerie Zenata</footer>

  <script>
    // === CONFIG — mets simplement ton URL Supabase ici ===
    const SUPABASE_URL = "https://ojgchrqtvkwzhjvwwftd.supabase.co"; // <- la tienne
    const GUIDES_BUCKET = "guides";

    const qs = new URL(location.href);
    const slug = (qs.searchParams.get('slug') || location.pathname.split('/').filter(Boolean).pop() || '').trim();
    const token = qs.searchParams.get('token') || '';

    document.getElementById('year').textContent = new Date().getFullYear();
    document.getElementById('guideSlug').textContent = slug ? `#${slug}` : '';

    const root = document.getElementById('root');

    function html(strings, ...vals){ return strings.map((s,i)=>s+(vals[i]??'')).join(''); }

    function section(g){
      const a = g.arrival?.fr || {};
      const allow = g.__sensitive?.token ? (token === g.__sensitive.token) : true;
      const door = allow ? (a.doorCode||'') : '•••• (masqué)';
      const rules = g.rules?.fr?.items || [];
      const dep = g.departure?.fr || {};
      const ess = g.essentials?.fr || {};
      const ams = g.amenities || [];

      return html`
        <div class="grid" style="gap:18px">
          <div class="hero"><img alt="${g.name||''}" src="${g.cover?.imageUrl||''}"></div>

          <div class="grid grid-3">
            <div class="tile"><div class="k">Adresse</div><div><strong>${g.address||''}</strong></div></div>
            <div class="tile"><div class="k">Wi‑Fi</div><div><strong>${(a.wifi?.ssid||'')}${a.wifi?.password? ' • '+a.wifi.password: ''}</strong></div></div>
            <div class="tile"><div class="k">Code porte</div><div><strong>${door}</strong></div></div>
          </div>

          <div class="grid grid-2">
            <div class="card"><h2>Arrivée & Check‑in</h2><div class="content">
              <div><span class="muted">À partir de</span> <strong>${a.checkin_from||''}</strong></div>
              ${a.parking? `<div><span class="muted">Parking</span> <strong>${a.parking}</strong></div>`:''}
              ${(a.notes||[]).length? `<ul>${(a.notes||[]).map(n=>`<li>${n}</li>`).join('')}</ul>`:''}
            </div></div>

            <div class="card"><h2>Règles</h2><div class="content"><ul>${rules.map(r=>`<li>${r}</li>`).join('')}</ul></div></div>

            <div class="card"><h2>Départ & Check‑out</h2><div class="content">
              ${dep.checkout_until? `<div><span class="muted">Avant</span> <strong>${dep.checkout_until}</strong></div>`:''}
              ${(dep.steps||[]).length? `<ul>${dep.steps.map(s=>`<li>${s.label}</li>`).join('')}</ul>`:''}
            </div></div>

            <div class="card"><h2>Infos utiles</h2><div class="content">
              ${ess.electricity? `<div><span class="muted">Électricité</span> ${ess.electricity}</div>`:''}
              ${ess.water? `<div><span class="muted">Eau</span> ${ess.water}</div>`:''}
              ${(ess.emergency||[]).map(c=>`<div><span class="muted">${c.label}</span> ${c.href? `<a href="${c.href}">${c.value}</a>`: c.value}</div>`).join('')}
            </div></div>

            ${ams.length? `<div class="card" style="grid-column:1/-1"><h2>Équipements</h2><div class="content">${ams.map(a=>`<span class="pill">${a.label||''}</span>`).join('')}</div></div>`:''}
          </div>

          ${g.coords? html`<div class="card"><h2>Plan & accès</h2><div class="content">
            <iframe title="map" style="width:100%;height:340px;border:1px solid var(--line);border-radius:12px" loading="lazy" referrerpolicy="no-referrer-when-downgrade"
              src="https://www.google.com/maps?q=${g.coords.lat},${g.coords.lng}&hl=fr&z=15&output=embed"></iframe>
          </div></div>`:''}

          ${g.brand?.supportPhone || g.brand?.supportWhatsApp || g.brand?.supportEmail ? html`<div class="card"><h2>Assistance</h2><div class="content actions">
            ${g.brand?.supportPhone? `<a class="btn" href="tel:${g.brand.supportPhone}">Appeler</a>`:''}
            ${g.brand?.supportWhatsApp? `<a class="btn" target="_blank" rel="noreferrer" href="${g.brand.supportWhatsApp}">WhatsApp 24/7</a>`:''}
            ${g.brand?.supportEmail? `<a class="btn" href="mailto:${g.brand.supportEmail}">Email</a>`:''}
            <button class="btn" onclick="window.print()">Télécharger en PDF</button>
          </div></div>`:''}

          ${g.__sensitive?.token && token !== g.__sensitive.token ? `<div class="warn">Certaines informations sensibles sont masquées. Ajoutez votre jeton à l’URL : <code>?token=VOTRE_TOKEN</code></div>`:''}
        </div>`;
    }

    async function boot(){
      if(!slug){
        root.innerHTML = '<div class="warn">Slug manquant. Utilisez /guide/<em>votre-slug</em></div>';
        return;
      }
      const jsonUrl = `${SUPABASE_URL}/storage/v1/object/public/${GUIDES_BUCKET}/${encodeURIComponent(slug)}.json`;
      try{
        const r = await fetch(jsonUrl, { cache:'no-store' });
        if(!r.ok){
          if(r.status === 404){
            root.innerHTML = `<div class="warn">Guide introuvable pour <b>${slug}</b>.<br>Vérifiez que <code>${jsonUrl}</code> existe dans le bucket <b>${GUIDES_BUCKET}</b>.</div>`;
            return;
          }
          throw new Error(`HTTP ${r.status}`);
        }
        const g = await r.json();
        const title = g?.name || `Guide ${slug}`;
        document.title = `${title} – Conciergerie Zenata`;
        root.innerHTML = html`
          <div class="header" style="padding:0 0 10px 0;">
            <div>
              <div class="badge">Guide</div>
              <h1 style="margin:.2rem 0 0 .0;font-size:28px">${title}</h1>
            </div>
          </div>
          ${section(g)}
        `;
      }catch(e){
        root.innerHTML = `<div class="warn">Erreur de chargement: ${e.message||e}</div>`;
      }
    }

    document.addEventListener('DOMContentLoaded', boot);
  </script>
</body>
</html> -->
<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Guide Voyageur – Conciergerie Zenata</title>
  <meta name="theme-color" content="#0B1220"/>
  <style>
    :root{
      --ink:#0B1220; --muted:#667085; --line:#E6EAF2; --bg:#FFFFFF; --card:#F7F9FC;
      --brand:#0F172A; --brand2:#1E293B; --accent:#0EA5E9; --success:#16A34A; --warn:#F59E0B;
      --radius-xl:22px; --radius-lg:16px; --radius-md:12px; --shadow:0 8px 24px rgba(2,6,23,.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; color:var(--ink); background:var(--bg)}

    /* Header */
    .nav{position:sticky;top:0;z-index:50;backdrop-filter:saturate(180%) blur(10px); background:rgba(255,255,255,.8); border-bottom:1px solid var(--line)}
    .container{max-width:1200px;margin:0 auto;padding:18px}
    .row{display:flex;align-items:center;gap:16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .brand img{height:28px}
    .spacer{flex:1}
    .cta{display:flex;gap:8px}
    .btn{appearance:none;border:1px solid var(--line);background:#fff;border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer;box-shadow:none}
    .btn.primary{background:linear-gradient(135deg,#0F172A,#1F2937);color:#fff;border-color:#0F172A}

    /* Hero */
    .hero{position:relative;border-radius:var(--radius-xl);overflow:hidden;border:1px solid var(--line);box-shadow:var(--shadow)}
    .hero img{width:100%;height:440px;object-fit:cover;display:block}
    .hero-grad{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.00) 40%, rgba(0,0,0,.55) 100%)}
    .hero-title{position:absolute;left:20px;right:20px;bottom:16px;color:#fff;display:flex;flex-direction:column;gap:6px}
    .hero-title h1{margin:0;font-size:28px;letter-spacing:.2px}
    .badge{display:inline-flex;gap:8px;align-items:center;font-size:12px;color:#E2E8F0}

    /* Summary tiles */
    .grid{display:grid;gap:16px}
    .grid-3{grid-template-columns:1fr 1fr 1fr}
    .tile{background:#fff;border:1px solid var(--line);border-radius:var(--radius-lg);padding:14px;box-shadow:var(--shadow)}
    .k{font-size:12px;color:var(--muted);margin-bottom:6px}

    /* Content */
    .grid-2{grid-template-columns:1.2fr .8fr}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius-lg);overflow:hidden;box-shadow:var(--shadow)}
    .card h2{margin:0;padding:14px 16px;border-bottom:1px solid var(--line);font-size:16px;background:#fff}
    .content{padding:16px}
    ul{margin:10px 0;padding-left:18px}
    .pill{display:inline-flex;gap:6px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;font-size:12px;margin:4px 6px 0 0;background:#fff}

    /* Empty state hidden */
    .empty{display:none}

    /* Assistant / sticky toolbar */
    .toolbar{position:sticky;bottom:14px;z-index:40;display:flex;justify-content:flex-end}
    .tool{display:flex;gap:8px;background:#fff;border:1px solid var(--line);border-radius:999px;padding:8px 10px;box-shadow:var(--shadow)}

    /* Map */
    .map{width:100%;height:360px;border:1px solid var(--line);border-radius:var(--radius-md)}

    /* Footer */
    .footer{padding:30px 0;color:var(--muted);font-size:12px;text-align:center}

    /* Print */
    @media print{
      .nav,.toolbar{display:none}
      .hero img{height:280px}
      body{background:#fff}
      .card,.tile{box-shadow:none}
    }

    @media(max-width:980px){
      .grid-2,.grid-3{grid-template-columns:1fr}
      .hero img{height:300px}
    }
  </style>
</head>
<body>
  <!-- NAV -->
  <div class="nav">
    <div class="container row">
      <div class="brand"><img src="/logo/logo_officiel_couleur_picto.png" alt=""> Conciergerie Zenata</div>
      <div class="spacer"></div>
      <div class="cta">
        <button class="btn" id="copyLink">Copier le lien</button>
        <button class="btn primary" id="printBtn">Télécharger en PDF</button>
      </div>
    </div>
  </div>

  <!-- MAIN -->
  <main class="container" id="root">
    <p class="k">Chargement du guide…</p>
  </main>

  <footer class="container footer">© <span id="year"></span> Conciergerie Zenata</footer>

  <script>
    // CONFIG
    const SUPABASE_URL = "https://ojgchrqtvkwzhjvwwftd.supabase.co"; // adapte si besoin
    const GUIDES_BUCKET = "guides";

    // URL params & state
    const U = new URL(location.href);
    const slug = (U.searchParams.get('slug') || location.pathname.split('/').filter(Boolean).pop() || '').trim();
    const token = U.searchParams.get('token') || '';

    const $ = (s)=> document.querySelector(s);
    const $$ = (s)=> Array.from(document.querySelectorAll(s));
    const root = $('#root');
    $('#year').textContent = new Date().getFullYear();

    // Helpers
    const h = (s, ...v) => s.map((x,i)=> x + (v[i] ?? '')).join('');
    const notEmpty = (arr)=> Array.isArray(arr) && arr.length>0;

    function hero(g){
      return h`<section class="hero">
        <img src="${g.cover?.imageUrl||''}" alt="${g.name||''}">
        <div class="hero-grad"></div>
        <div class="hero-title">
          <span class="badge">Guide voyageur</span>
          <h1>${g.name||'Votre hébergement'}</h1>
        </div>
      </section>`
    }

    function tiles(g){
      const a = g.arrival?.fr || {};
      const allow = g.__sensitive?.token ? (token === g.__sensitive.token) : true;
      const door = allow ? (a.doorCode||'') : '•••• (masqué)';
      return h`<section class="grid grid-3">
        ${g.address? h`<div class="tile"><div class="k">Adresse</div><div><strong>${g.address}</strong></div></div>`:''}
        ${(a.wifi?.ssid || a.wifi?.password)? h`<div class="tile"><div class="k">Wi‑Fi</div><div><strong>${a.wifi?.ssid||''}${a.wifi?.password? ' • '+a.wifi.password:''}</strong></div></div>`:''}
        ${(door)? h`<div class="tile"><div class="k">Code porte</div><div><strong>${door}</strong></div></div>`:''}
      </section>`
    }

    function sectionCols(g){
      const a = g.arrival?.fr || {};
      const rules = g.rules?.fr?.items || [];
      const dep = g.departure?.fr || {};
      const ess = g.essentials?.fr || {};
      const ams = g.amenities || [];

      const left = h`
        <div class="card">
          <h2>Arrivée & Check‑in</h2>
          <div class="content">
            ${a.checkin_from? h`<div><span class="k">À partir de</span> <strong>${a.checkin_from}</strong></div>`:''}
            ${a.parking? h`<div><span class="k">Parking</span> <strong>${a.parking}</strong></div>`:''}
            ${notEmpty(a.notes)? h`<ul>${a.notes.map(n=>`<li>${n}</li>`).join('')}</ul>`:''}
          </div>
        </div>

        ${notEmpty(rules)? h`<div class="card"><h2>Règles</h2><div class="content"><ul>${rules.map(r=>`<li>${r}</li>`).join('')}</ul></div></div>`:''}

        <div class="card">
          <h2>Départ & Check‑out</h2>
          <div class="content">
            ${dep.checkout_until? h`<div><span class="k">Avant</span> <strong>${dep.checkout_until}</strong></div>`:''}
            ${notEmpty(dep.steps)? h`<ul>${dep.steps.map(s=>`<li>${s.label}</li>`).join('')}</ul>`:''}
          </div>
        </div>
      `;

      const right = h`
        ${ (ess.electricity||ess.water||notEmpty(ess.emergency))? h`<div class="card"><h2>Infos utiles</h2><div class="content">
          ${ess.electricity? `<div><span class="k">Électricité</span> ${ess.electricity}</div>`:''}
          ${ess.water? `<div><span class="k">Eau</span> ${ess.water}</div>`:''}
          ${notEmpty(ess.emergency)? ess.emergency.map(c=>`<div><span class="k">${c.label}</span> ${c.href? `<a href="${c.href}">${c.value}</a>`:c.value}</div>`).join(''):''}
        </div></div>`:''}

        ${notEmpty(ams)? h`<div class="card"><h2>Équipements</h2><div class="content">${ams.map(a=>`<span class="pill">${a.label||''}</span>`).join('')}</div></div>`:''}

        ${g.coords? h`<div class="card"><h2>Plan & accès</h2><div class="content">
          <iframe class="map" title="map" loading="lazy" referrerpolicy="no-referrer-when-downgrade" src="https://www.google.com/maps?q=${g.coords.lat},${g.coords.lng}&hl=fr&z=15&output=embed"></iframe>
        </div></div>`:''}

        ${(g.brand?.supportPhone || g.brand?.supportWhatsApp || g.brand?.supportEmail)? h`<div class="card"><h2>Assistance</h2><div class="content" style="display:flex;gap:10px;flex-wrap:wrap">
          ${g.brand?.supportPhone? `<a class="btn" href="tel:${g.brand.supportPhone}">Appeler</a>`:''}
          ${g.brand?.supportWhatsApp? `<a class="btn" target="_blank" rel="noreferrer" href="${g.brand.supportWhatsApp}">WhatsApp 24/7</a>`:''}
          ${g.brand?.supportEmail? `<a class="btn" href="mailto:${g.brand.supportEmail}">Email</a>`:''}
        </div></div>`:''}
      `;

      return h`<section class="grid grid-2">
        <div>${left}</div>
        <div>${right}</div>
      </section>`
    }

    function sensitiveBanner(g){
      if(g.__sensitive?.token && token !== g.__sensitive.token){
        return h`<div class="card" style="margin-top:12px"><div class="content" style="display:flex;align-items:center;gap:10px">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#F59E0B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0"/><path d="M12 8v4"/><path d="M12 16h.01"/></svg>
          <div>Certaines informations sensibles sont masquées. Ajoutez votre jeton à l’URL : <code>?token=VOTRE_TOKEN</code></div>
        </div></div>`;
      }
      return '';
    }

    async function boot(){
      if(!slug){ root.innerHTML = '<div class="card"><div class="content">Slug manquant. Utilisez /guide/<em>votre-slug</em></div></div>'; return; }
      const jsonUrl = `${SUPABASE_URL}/storage/v1/object/public/${GUIDES_BUCKET}/${encodeURIComponent(slug)}.json`;
      try{
        const r = await fetch(jsonUrl, { cache:'no-store' });
        if(!r.ok){
          const msg = r.status===404? `Guide introuvable pour <b>${slug}</b>.<br>Vérifiez que <code>${jsonUrl}</code> existe.` : `Erreur HTTP ${r.status}`;
          root.innerHTML = `<div class="card"><div class="content">${msg}</div></div>`;
          return;
        }
        const g = await r.json();
        document.title = `${g?.name || 'Guide'} – Conciergerie Zenata`;
        root.innerHTML = [
          hero(g),
          tiles(g),
          sectionCols(g),
          sensitiveBanner(g)
        ].join('');

        // Toolbar actions
        $('#printBtn').onclick = ()=> window.print();
        $('#copyLink').onclick = async()=>{ try{ await navigator.clipboard.writeText(location.href); const b=$('#copyLink'); const t=b.textContent; b.textContent='Lien copié'; setTimeout(()=> b.textContent=t, 1200);}catch{}}
      }catch(e){
        root.innerHTML = `<div class="card"><div class="content">Erreur: ${e.message||e}</div></div>`;
      }
    }

    document.addEventListener('DOMContentLoaded', boot);
  </script>
</body>
</html>
